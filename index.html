<!doctype html>
<html lang="de">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Rechnung Generator — Altenbetreuung24 Enterprise v4</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700;800&family=JetBrains+Mono:wght@400;500;600&display=swap" rel="stylesheet">
<script defer src="https://cdn.jsdelivr.net/npm/xlsx@0.19.3/dist/xlsx.full.min.js"></script>
</head>
<body>

<!-- LOGIN OVERLAY -->
<div class="login-overlay" id="loginOverlay" style="display:flex">
  <div class="login-card">
    <h1>Altenbetreuung24</h1>
    <div class="login-sub">Rechnungsverwaltung — Enterprise v4.0</div>
    <input id="loginPassword" type="password" placeholder="Passwort eingeben..." autofocus/>
    <button class="btn btn-a" id="btnLogin" type="button">Anmelden</button>
    <div class="login-error" id="loginError">Falsches Passwort. Bitte erneut versuchen.</div>
    <div class="login-version">PhD-Level Invoicing System</div>
  </div>
</div>

<!-- APP CONTAINER -->
<div id="appContainer" style="display:none;width:100%;height:100%">

<aside class="sidebar">
  <div class="header-bar">
    <div>
      <div class="app-title">Altenbetreuung24</div>
      <div class="app-version">Enterprise v4.0 — PhD-Level</div>
    </div>
    <button class="btn" id="btnLogout" type="button" style="padding:4px 10px;font-size:10px">Abmelden</button>
  </div>
  <div class="clock-bar">
    <span class="clock-text" id="liveClock">—</span>
    <span id="syncStatus" class="badge b-info sync-badge">Offline</span>
  </div>
  <div class="tabs">
    <div class="tab active" data-tab="invoice">Rechnung</div>
    <div class="tab" data-tab="clients">Kunden</div>
    <div class="tab" data-tab="persons">Betreuer</div>
    <div class="tab" data-tab="reminders">Termine</div>
    <div class="tab" data-tab="history">Historie</div>
    <div class="tab" data-tab="settings">System</div>
  </div>
  <div class="tab-body">

    <!-- ============ TAB: RECHNUNG ============ -->
    <div class="tab-panel active" id="panelInvoice">

      <div class="card">
        <div class="card-h">
          <span class="card-t">Kunde (Familie)</span>
          <span id="saveState" class="badge b-ok">Gespeichert</span>
        </div>
        <select id="selClient"></select>
        <div class="btn-row">
          <button class="btn btn-a" id="btnQuickClient" type="button">+ Neuer Kunde</button>
          <button class="btn" id="btnGoClients" type="button">Kunden verwalten</button>
        </div>
      </div>

      <div class="card" id="cardAssignments">
        <div class="card-h">
          <span class="card-t">Zugewiesene Betreuer</span>
          <span class="badge b-info">Zuweisung</span>
        </div>
        <div id="assignList"></div>
        <div class="btn-row">
          <button class="btn btn-a" id="btnNewAssign">+ Betreuer zuweisen</button>
        </div>
        <div class="hint" style="margin-top:8px">Jede Zuweisung hat eigene Tagessätze und Zuschläge.</div>
      </div>

      <div class="card" id="cardInvData" style="display:none">
        <div class="card-h">
          <span class="card-t">Rechnungsdaten</span>
          <span class="badge b-info">A4</span>
        </div>

        <div class="row">
          <div><label>Rechnungsdatum</label><input id="invoiceDate" type="date"/></div>
          <div><label>Rechnungsnummer</label><input id="invoiceNo" placeholder="2026/001"/></div>
        </div>
        <div class="row">
          <div><label>Leistungsbeginn</label><input id="startDate" type="date"/></div>
          <div><label>Leistungsende</label><input id="endDate" type="date"/></div>
        </div>
        <div class="row">
          <div><label>Anzahl Tage</label><input id="dayCount" type="number" min="1" step="1"/></div>
          <div><label>Tagessatz (&euro;)</label><input id="dailyRate" type="text" inputmode="decimal" placeholder="85,00"/></div>
        </div>
        <label class="check-label"><input id="includeLastDay" type="checkbox"/><span>Letzter Tag wird vergütet</span></label>
        <div class="row">
          <div><label>Zahlungsfrist (Tage)</label><input id="payDays" type="number" min="0" step="1"/></div>
        </div>

        <div class="divider"></div>
        <div class="card-h"><span class="card-t">Zuschläge</span></div>
        <div class="row">
          <div><label class="check-label"><input id="xmasOn" type="checkbox"/><span>Weihnachtsgeld</span></label><input id="xmasVal" type="text" inputmode="decimal" placeholder="100,00"/></div>
          <div><label class="check-label"><input id="newyearOn" type="checkbox"/><span>Silvestergeld</span></label><input id="newyearVal" type="text" inputmode="decimal" placeholder="100,00"/></div>
        </div>
        <div class="row">
          <div><label class="check-label"><input id="easterOn" type="checkbox"/><span>Ostergeld</span></label><input id="easterVal" type="text" inputmode="decimal" placeholder="100,00"/></div>
          <div><label class="check-label"><input id="travelOn" type="checkbox"/><span>Fahrtkosten</span></label><input id="travelVal" type="text" inputmode="decimal" placeholder="300,00"/></div>
        </div>
        <div class="row">
          <div><label class="check-label"><input id="svsOn" type="checkbox"/><span>SVS</span></label><input id="svsVal" type="text" inputmode="decimal" placeholder="341,70"/></div>
          <div><label class="check-label"><input id="adminFeeOn" type="checkbox"/><span>Verwaltungskosten</span></label><input id="adminFeeVal" type="text" inputmode="decimal" placeholder="192,00"/></div>
        </div>
        <div class="row">
          <div><label class="check-label"><input id="entryFeeOn" type="checkbox"/><span>Einstiegsgebühr</span></label><input id="entryFeeVal" type="text" inputmode="decimal" placeholder="480,00"/></div>
          <div><label class="check-label"><input id="depositOn" type="checkbox"/><span>Kaution</span></label><input id="depositVal" type="text" inputmode="decimal" placeholder="0,00"/></div>
        </div>
        <div class="row">
          <div><label class="check-label"><input id="cancelFeeOn" type="checkbox"/><span>Kündigungsgebühr</span></label><input id="cancelFeeVal" type="text" inputmode="decimal" placeholder="800,00"/></div>
        </div>
        <div class="hint" style="margin-top:8px">Berechnung: <b>Ende − Anfang + 1</b> = Tage.</div>
        <div id="dateError" class="warn-box" style="display:none;margin-top:8px">Leistungsende liegt vor Leistungsbeginn!</div>

        <div class="divider"></div>
        <div class="btn-row">
          <button class="btn btn-g" id="btnPdf">PDF exportieren</button>
          <button class="btn btn-a" id="btnXlsx">Excel (.xlsx)</button>
          <button class="btn" id="btnOds">ODS</button>
          <button class="btn btn-w" id="btnMailto">E-Mail Entwurf</button>
        </div>
        <div class="btn-row">
          <button class="btn btn-g" id="btnFinalize">&#10003; Rechnung abschließen</button>
          <button class="btn" id="btnRemoveAssign">Zuweisung entfernen</button>
        </div>
      </div>

    </div>

    <!-- ============ TAB: KUNDEN ============ -->
    <div class="tab-panel" id="panelClients">
      <div class="card">
        <div class="card-h"><span class="card-t">Kundenverwaltung</span></div>
        <select id="selClientMgmt"></select>
        <div class="btn-row">
          <button class="btn btn-a" id="btnNewClient">+ Neuer Kunde</button>
          <button class="btn btn-d" id="btnDeleteClient">Löschen</button>
        </div>
      </div>
      <div class="card" id="cardClientEdit">
        <div class="card-h"><span class="card-t">Kundendaten</span></div>
        <label>Name</label>
        <input id="clientName" placeholder="Vor- und Nachname"/>
        <label>Adresse</label>
        <textarea id="clientAddress" placeholder="Straße, PLZ Ort"></textarea>
        <label>E-Mail</label>
        <input id="clientEmail" placeholder="email@beispiel.at"/>
        <div class="row">
          <div>
            <label>Telefon (Hauptnummer)</label>
            <input id="clientPhone" placeholder="+43 ..." type="tel"/>
          </div>
          <div>
            <label>Telefon 2 (optional)</label>
            <input id="clientPhone2" placeholder="+43 ..." type="tel"/>
          </div>
        </div>
        <label>Notizen (intern)</label>
        <textarea id="clientNotes" placeholder="Interne Notizen zu diesem Kunden..."></textarea>
        <div id="clientPhoneActions" class="btn-row"></div>
        <div class="info-box" style="margin-top:10px">Telefonnummern und Notizen erscheinen <b>nicht</b> auf der Rechnung — nur intern sichtbar.</div>
      </div>

      <div class="card" id="cardPflegestufe">
        <div class="card-h"><span class="card-t">Pflegestufe & Tagessatz-Kalkulation</span></div>
        <div class="row">
          <div>
            <label>Pflegestufe (1–7)</label>
            <select id="clientPflegestufe">
              <option value="1">Stufe 1</option>
              <option value="2">Stufe 2</option>
              <option value="3">Stufe 3</option>
              <option value="4">Stufe 4</option>
              <option value="5">Stufe 5</option>
              <option value="6">Stufe 6</option>
              <option value="7">Stufe 7</option>
            </select>
          </div>
          <div>
            <label>Netto-Einkommen (€)</label>
            <input id="clientNetIncome" type="number" min="0" step="100" placeholder="0"/>
          </div>
        </div>
        <div class="pflege-grid">
          <label class="check-label"><input id="clientSecondPerson" type="checkbox"/><span>2. Person im Haushalt (+10€)</span></label>
          <label class="check-label"><input id="clientNightWork" type="checkbox"/><span>Nachtarbeit (+10€)</span></label>
          <label class="check-label"><input id="clientNoBreak" type="checkbox"/><span>Pausenausfall (+10€)</span></label>
          <label class="check-label"><input id="clientHasPet" type="checkbox"/><span>Haustier (+5€)</span></label>
          <label class="check-label"><input id="clientNeedsDriver" type="checkbox"/><span>Führerschein (+10€)</span></label>
          <label class="check-label"><input id="clientGoodGerman" type="checkbox"/><span>Gute Deutschkenntnisse (min 90€)</span></label>
          <label class="check-label"><input id="clientFoerderung" type="checkbox"/><span>Förderung beantragt</span></label>
        </div>
        <div class="rate-calc-box" id="rateCalculation"></div>
      </div>
      <div class="card" id="cardClientStats">
        <div class="card-h"><span class="card-t">Kundenstatistik</span></div>
        <div id="clientStatsContent"></div>
      </div>
    </div>

    <!-- ============ TAB: BETREUER ============ -->
    <div class="tab-panel" id="panelPersons">
      <div class="card">
        <div class="card-h"><span class="card-t">Betreuerverwaltung</span></div>
        <select id="selPerson"></select>
        <div class="btn-row">
          <button class="btn btn-a" id="btnNewPerson">+ Neue Person</button>
          <button class="btn" id="btnNewTeam">+ Neues Team</button>
          <button class="btn btn-d" id="btnDeletePerson">Löschen</button>
        </div>
      </div>
      <div class="card" id="cardPersonEdit">
        <div class="card-h"><span class="card-t">Personendaten</span></div>
        <label>Name</label><input id="personName" placeholder="Vor- und Nachname"/>
        <label>E-Mail</label><input id="personEmail" placeholder="email@beispiel.at"/>
        <label>Telefon</label><input id="personPhone" placeholder="+43 ..."/>
        <div class="divider"></div>
        <label>Adresse (für Rechnung)</label>
        <textarea id="personAddress" placeholder="Straße, PLZ Ort"></textarea>
        <div class="divider"></div>
        <div class="logo-drop" id="logoDrop">
          <div class="logo-drop-top">
            <div class="hint"><b>Logo</b><br>Hochladen / Drag&amp;Drop / <b>STRG+V</b></div>
            <div class="mini-logo"><img id="miniLogoImg" alt="Logo"/></div>
          </div>
          <div class="row" style="margin-top:8px">
            <div><label>Logo-Datei</label><input id="logoFile" type="file" accept="image/*"/></div>
            <div><label>Modus</label><select id="logoFit"><option value="contain">Anpassen</option><option value="cover">Füllen</option></select></div>
          </div>
        </div>
        <div class="divider"></div>
        <label>Bankverbindung</label>
        <div class="row">
          <div><input id="bankName" placeholder="Name der Bank"/></div>
          <div><input id="bic" placeholder="BIC"/></div>
        </div>
        <label>IBAN</label><input id="iban" placeholder="AT..."/>
        <label>Zahlungshinweis</label><input id="payNote" placeholder="Zahlbar sofort nach Rechnungserhalt ohne Abzug."/>
      </div>
      <div class="card" id="cardPersonTeams">
        <div class="card-h"><span class="card-t">Teams</span></div>
        <div id="personTeamsList" class="hint">Keine Teams.</div>
        <div class="member-wrap" id="teamMemberWrap" style="display:none">
          <label>Rechnungsempfänger</label>
          <select id="teamMemberSel"></select>
          <div class="hint" style="margin-top:4px">Auf der Rechnung erscheint nur diese Person.</div>
        </div>
      </div>
    </div>

    <!-- ============ TAB: ERINNERUNGEN ============ -->
    <div class="tab-panel" id="panelReminders">
      <div class="card">
        <div class="card-h">
          <span class="card-t">Automatische Rechnungserinnerungen</span>
          <span class="badge b-info">Smart</span>
        </div>
        <div class="hint" style="margin-bottom:10px">Zeigt automatisch an, welche Familien eine neue Rechnung benötigen (28-Tage-Zyklus).</div>
        <div id="autoReminders"></div>
      </div>
      <div class="card">
        <div class="card-h">
          <span class="card-t">Neue Erinnerung erstellen</span>
        </div>
        <div class="row">
          <div>
            <label>Kunde (optional)</label>
            <select id="reminderClient"><option value="">Alle / Allgemein</option></select>
          </div>
          <div>
            <label>Fälligkeitsdatum</label>
            <input id="reminderDue" type="date"/>
          </div>
        </div>
        <label>Notiz / Beschreibung</label>
        <input id="reminderNote" placeholder="z.B. Rechnung für Familie Müller erstellen"/>
        <div class="row" style="margin-top:8px">
          <div>
            <label>Wiederholung</label>
            <select id="reminderRecurring">
              <option value="none">Einmalig</option>
              <option value="monthly">Monatlich</option>
            </select>
          </div>
          <div style="display:flex;align-items:flex-end">
            <button class="btn btn-g" id="btnAddReminder" type="button" style="width:100%">+ Erinnerung erstellen</button>
          </div>
        </div>
      </div>
      <div class="card">
        <div class="card-h">
          <span class="card-t">Manuelle Erinnerungen</span>
        </div>
        <div id="manualReminders"></div>
      </div>
    </div>

    <!-- ============ TAB: HISTORIE ============ -->
    <div class="tab-panel" id="panelHistory">
      <div class="card">
        <div class="card-h">
          <span class="card-t">Rechnungshistorie</span>
          <span id="histCount" class="badge b-info">0</span>
        </div>
        <div class="row">
          <div><label>Kunde filtern</label><select id="histFilterClient"><option value="">Alle Kunden</option></select></div>
          <div><label>Betreuer filtern</label><select id="histFilterPerson"><option value="">Alle Betreuer</option></select></div>
        </div>
        <div class="row">
          <div><label>Von</label><input id="histFrom" type="date"/></div>
          <div><label>Bis</label><input id="histTo" type="date"/></div>
        </div>
        <label class="check-label" style="margin-top:8px"><input id="histByInvDate" type="checkbox"/><span>Nach Rechnungsdatum filtern (statt Leistungszeitraum)</span></label>
      </div>
      <div class="card">
        <div class="stat-grid" id="histStats"></div>
      </div>
      <div class="card" style="overflow-x:auto">
        <table class="htable">
          <thead><tr>
            <th>Nr.</th><th>Datum</th><th>Kunde</th><th>Betreuer</th><th>Zeitraum</th><th>Tage</th><th>Betrag</th><th>Status</th><th></th>
          </tr></thead>
          <tbody id="histBody"></tbody>
        </table>
      </div>
    </div>

    <!-- ============ TAB: SYSTEM ============ -->
    <div class="tab-panel" id="panelSettings">
      <div class="card">
        <div class="card-h"><span class="card-t">Globales Logo</span><span class="badge b-info">Alle Rechnungen</span></div>
        <div class="hint" style="margin-bottom:8px">Dieses Logo wird auf <b>allen</b> Rechnungen verwendet, sofern kein individuelles Logo beim Betreuer hinterlegt ist.</div>
        <div class="global-logo-wrap">
          <div class="global-logo-preview">
            <img id="globalLogoPreview" alt="Logo"/>
          </div>
          <div style="flex:1">
            <input id="globalLogoFile" type="file" accept="image/*"/>
            <div class="row" style="margin-top:6px">
              <div><select id="globalLogoFit"><option value="contain">Anpassen</option><option value="cover">Füllen</option></select></div>
              <div><button class="btn btn-d" id="btnRemoveGlobalLogo" type="button" style="width:100%">Entfernen</button></div>
            </div>
          </div>
        </div>
      </div>
      <div class="card">
        <div class="card-h"><span class="card-t">Datenverwaltung</span></div>
        <div class="btn-row">
          <button class="btn btn-g" id="btnExportJSON">Vollständiges Backup (JSON)</button>
          <button class="btn btn-w" id="btnImportJSON">Backup wiederherstellen</button>
        </div>
        <div class="btn-row">
          <button class="btn" id="btnBackendMail">E-Mail senden (Backend)</button>
        </div>
        <div class="divider"></div>
        <div class="card-h"><span class="card-t">Cloud-Synchronisation (Netlify)</span></div>
        <div class="btn-row">
          <button class="btn btn-a" id="btnCloudSync">In Cloud speichern</button>
          <button class="btn btn-w" id="btnCloudLoad">Aus Cloud laden</button>
        </div>
        <div class="hint" style="margin-top:6px">Automatische Synchronisation alle 60 Sekunden wenn online.</div>
        <div class="divider"></div>
        <div class="card-h"><span class="card-t">Speichernutzung</span></div>
        <div id="storageInfo" class="hint"></div>
        <div class="divider"></div>
        <div class="card-h"><span class="card-t">Gefahrenzone</span></div>
        <button class="btn btn-d" id="btnResetAll">Alle Daten löschen</button>
        <div class="hint" style="margin-top:6px">Erstellen Sie vorher ein Backup!</div>
      </div>
      <div class="card">
        <div class="card-h"><span class="card-t">Systeminfo</span></div>
        <div class="hint">
          <b>Version:</b> 4.0 Enterprise PhD-Level<br>
          <b>Schema:</b> v4 (erweitert mit Pflegestufe, Erinnerungen, Cloud)<br>
          <b>Architektur:</b> ES Modules + Vite + Netlify Functions<br>
          <b>Speicherort:</b> localStorage + Netlify Cloud<br>
          <b>Datenschutz:</b> Passwortgeschützt<br>
          <b>Features:</b> Pflegestufe-Kalkulation, Smart-Erinnerungen, PDF/Excel/ODS Export, Globales Logo
        </div>
      </div>
    </div>

  </div>
</aside>

<main class="main">
  <div class="paper-wrap">
    <div class="paper" id="paper">
      <div class="paper-inner" id="paperInner">
        <div class="top-band">
          <div class="logo-area"><img id="paperLogo" alt="Logo"/></div>
          <div class="addr-right" id="paperAddrRight"></div>
        </div>
        <div class="from-block" id="paperFromBlock"></div>
        <div class="bill-meta">
          <div class="left" id="paperMetaLeft"></div>
          <div class="right" id="paperMetaRight"></div>
        </div>
        <div class="title-bar">R E C H N U N G</div>
        <table class="tbl"><thead><tr>
          <th class="col1">Leistungszeitraum</th><th class="col2">Beschreibung</th><th class="col3">Gesamtpreis</th>
        </tr></thead><tbody id="paperTbody"></tbody></table>
        <div class="pay-line" id="paperPayLine"></div>
        <div class="sum-row"><div><b>Rechnungsbetrag:</b></div><div class="sum-box" id="paperTotalBox"></div></div>
        <div class="bottom-block">
          <div class="bank" id="paperBank"></div>
          <div style="text-align:right;min-width:70mm">
            <div class="sig"><b>BAR erhalten Unterschrift</b></div>
            <div class="sig-line"></div>
            <div class="sig" style="margin-top:6mm">Zahlbar sofort nach Rechnungserhalt ohne Abzug</div>
          </div>
        </div>
      </div>
    </div>
  </div>
</main>

<!-- Quick Add Client Modal -->
<div class="modal" id="modalClient" aria-hidden="true">
  <div class="modal-backdrop" data-close="1"></div>
  <div class="modal-card" role="dialog" aria-modal="true" aria-labelledby="modalClientTitle">
    <div class="modal-h">
      <div>
        <div class="modal-title" id="modalClientTitle">Neuen Kunden anlegen</div>
        <div class="modal-sub">Schnellformular — wird sofort in Rechnung & Kundenliste verfügbar.</div>
      </div>
      <button class="icon-btn" id="btnCloseClientModal" type="button" aria-label="Schließen">&#10005;</button>
    </div>
    <div class="grid2">
      <label class="lbl">Name
        <input id="qcName" class="inp" placeholder="z.B. Familie Muster" autocomplete="off"/>
      </label>
      <label class="lbl">E-Mail
        <input id="qcEmail" class="inp" placeholder="name@mail.com" autocomplete="off"/>
      </label>
      <label class="lbl">Telefon
        <input id="qcPhone" class="inp" placeholder="+43 ..." autocomplete="off"/>
      </label>
      <label class="lbl">Telefon 2
        <input id="qcPhone2" class="inp" placeholder="optional" autocomplete="off"/>
      </label>
      <label class="lbl" style="grid-column:1/-1">Adresse (mehrzeilig)
        <textarea id="qcAddress" class="inp" rows="4" placeholder="Straße, PLZ Ort"></textarea>
      </label>
      <label class="lbl" style="grid-column:1/-1">Notizen
        <textarea id="qcNotes" class="inp" rows="3" placeholder="optional"></textarea>
      </label>
    </div>
    <div class="modal-actions">
      <button class="btn" id="btnCancelClientModal" type="button">Abbrechen</button>
      <button class="btn btn-g" id="btnSaveClientModal" type="button">Speichern</button>
    </div>
  </div>
</div>

<!-- Assign Person Modal -->
<div class="modal" id="modalAssign" aria-hidden="true">
  <div class="modal-backdrop" data-close="1"></div>
  <div class="modal-card" role="dialog" aria-modal="true" aria-labelledby="modalAssignTitle" style="max-width:480px">
    <div class="modal-h">
      <div>
        <div class="modal-title" id="modalAssignTitle">Betreuer zuweisen</div>
        <div class="modal-sub">Betreuer für diesen Kunden auswählen.</div>
      </div>
      <button class="icon-btn" id="btnCloseAssignModal" type="button" aria-label="Schließen">&#10005;</button>
    </div>
    <label>Betreuer auswählen</label>
    <select id="assignPersonSel"></select>
    <div class="modal-actions">
      <button class="btn" id="btnCancelAssignModal" type="button">Abbrechen</button>
      <button class="btn btn-g" id="btnSaveAssignModal" type="button">Zuweisen</button>
    </div>
  </div>
</div>

</div><!-- /appContainer -->
<script type="module" src="/src/main.js"></script>
</body>
</html>
